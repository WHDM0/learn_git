	with DW_TMP_ORG AS (
			SELECT DISTINCT 'BRA' ORG_LEVEL,
				FILIALE_ID      SUBCOMPANY_ID,
				FILIALE_NAME    SUBCOMPANY_NAME,
				BRANCH_ID       DES_BRANCH_ID,
				BRANCH_NAME     DES_BRANCH_NAME,
				F_PARTY_ID      BRANCH_ID,
				F_PARTY_NAME    BRANCH_NAME
			FROM ODS..ODS_SALESBI_SM_PARTY_MAPPING_H   
			WHERE TO_CHAR(ETL_DATE,'YYYYMMDD') = (
				SELECT MAX(TO_CHAR(ETL_DATE,'YYYYMMDD')) 
			  	  FROM ODS..ODS_SALESBI_SM_PARTY_MAPPING_H)
	    UNION 
	    SELECT DISTINCT 'SUB' ORG_LEVEL,
				FILIALE_ID      SUBCOMPANY_ID,
				FILIALE_NAME    SUBCOMPANY_NAME,
				FILIALE_ID      DES_BRANCH_ID,
				FILIALE_NAME    DES_BRANCH_NAME,
				FILIALE_ID      BRANCH_ID,
				FILIALE_NAME    BRANCH_NAME
			FROM ODS..ODS_SALESBI_SM_PARTY_MAPPING_H   
			WHERE TO_CHAR(ETL_DATE,'YYYYMMDD') = (
				SELECT MAX(TO_CHAR(ETL_DATE,'YYYYMMDD')) 
			  	  FROM ODS..ODS_SALESBI_SM_PARTY_MAPPING_H)
		UNION 
	    SELECT DISTINCT 'HEAD' ORG_LEVEL,
				'111111111'        SUBCOMPANY_ID,
				'TV销售总部'       SUBCOMPANY_NAME,
				'111111111'        DES_BRANCH_ID,
				'TV销售总部'       DES_BRANCH_NAME,
				PARTY_ID        BRANCH_ID,
				GROUP_NAME      BRANCH_NAME
			FROM ODS..ODS_CRM_PARTY_GROUP PG   
			WHERE TO_CHAR(ETL_DATE,'YYYYMMDD') = (
				SELECT MAX(TO_CHAR(ETL_DATE,'YYYYMMDD')) 
			  	  FROM ODS..ODS_CRM_PARTY_GROUP)
		      AND PG.PARTY_ID IN ('111111111','700000000')
	    ),
		SAP_COST_CENTER_MAPPING AS (
		--成本中心与机构的对照关系，存在一对多的关系，需要挑选出其中一个使用
		SELECT SAP_COST_CENTER_CODE, PARTY_ID
			  FROM (
			    SELECT SAP_COST_CENTER_CODE,
				       PARTY_ID,
					   RANK() OVER(PARTITION BY SAP_COST_CENTER_CODE ORDER BY DATA_TYPE DESC,PARTY_ID,RANDOM()) RANK_ID
				 FROM
				  (SELECT SAP_COST_CENTER_CODE,PARTY_ID,1 DATA_TYPE
				    FROM 
				   ( SELECT SCCCM.SAP_COST_CENTER_CODE,
				               PG.PARTY_ID,
				               RANK() OVER(PARTITION BY SCCCM.SAP_COST_CENTER_CODE ORDER BY SCCCM.CREATE_DATE DESC, PG.CREATE_DATE DESC, PG.LAST_MODIFY_DATE DESC, RANDOM()) RANK_ID
				          FROM (SELECT *
							      FROM ODS..ODS_CRM_SAP_CRM_COST_CENTER_MAPPING 
						         WHERE TO_CHAR(ETL_DATE,'YYYYMMDD')=(
				     SELECT TO_CHAR(MAX(ETL_DATE),'YYYYMMDD') FROM ODS..ODS_CRM_SAP_CRM_COST_CENTER_MAPPING
				   
	      ) ) SCCCM,
				               (SELECT *
							      FROM ODS..ODS_CRM_DEPARTMENT 
								 WHERE TO_CHAR(ETL_DATE,'YYYYMMDD')=(
				     SELECT TO_CHAR(MAX(ETL_DATE),'YYYYMMDD') FROM ODS..ODS_CRM_DEPARTMENT
				   
	      ) ) D,
				               (SELECT *
							      FROM ODS..ODS_CRM_PARTY_GROUP   
								 WHERE TO_CHAR(ETL_DATE,'YYYYMMDD')=(
				     SELECT TO_CHAR(MAX(ETL_DATE),'YYYYMMDD') FROM ODS..ODS_CRM_PARTY_GROUP
				   
	      ) ) PG
				         WHERE 1 = 1
				           AND SCCCM.CRM_DEPT_ID = D.DEPARTMENT_ID
				           AND D.PARTY_ID = PG.PARTY_ID
				           AND SCCCM.STATUS = 'Y') T
				 WHERE RANK_ID = 1 
				  UNION ALL
				  SELECT T.SAP_COST_CENTER_CODE,
				         T.ORG_ID,
						 2 DATA_TYPE
				    FROM ODS..ODS_OMS_T_BD_COST_CENTER_ADDTION T
				   WHERE TO_CHAR(T.ETL_DATE,'YYYYMMDD')=(
				   	 SELECT TO_CHAR(MAX(ETL_DATE),'YYYYMMDD')
					   FROM ODS..ODS_OMS_T_BD_COST_CENTER_ADDTION
				   )
			    ) T1
			 ) T2 
			WHERE T2.RANK_ID = 1
		)
		
		SELECT DISTINCT  
				SUBCOMPANY_ID,
				SUBCOMPANY_NAME,
				DES_BRANCH_ID,
				DES_BRANCH_NAME,
				BRANCH_ID,
				BRANCH_NAME,
				ORG_LEVEL,
				SAP_COST_CENTER_CODE
		FROM SAP_COST_CENTER_MAPPING SCCCM_DP
		 inner JOIN DW_TMP_ORG ORG
		   ON SCCCM_DP.PARTY_ID=ORG.BRANCH_ID
